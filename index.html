
<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>System Terminal</title>
  <style>
    :root {
      --bg: #0a0f0a;
      --fg: #b6f7b6;
      --accent: #2af02a;
      --muted: #6f996f;
      --error: #ff4d4d;
    }
    html, body { height: 100%; background: var(--bg); color: var(--fg); margin: 0; }
    body { font-family: "Consolas","Courier New",monospace; }
    .screen {
      max-width: 900px; margin: 0 auto; padding: 16px;
      box-sizing: border-box; min-height: 100%;
    }
    .title { color: var(--accent); letter-spacing: 0.1em; margin-bottom: 8px; }
    .bar { height: 1px; background: var(--accent); opacity: .4; margin: 8px 0 16px; }
    .line { white-space: pre-wrap; }
    .cursor {
      display: inline-block; width: 10px; background: var(--accent);
      animation: blink 1s steps(1, start) infinite;
      margin-left: 4px; height: 1em; vertical-align: text-bottom;
    }
    @keyframes blink { 50% { opacity: 0; } }
    .input-row { display: flex; gap: 8px; align-items: center; margin-top: 6px; }
    .prompt { color: var(--accent); }
    input[type="text"], input[type="password"] {
      background: #0e120e; border: 1px solid #214621; color: var(--fg);
      padding: 8px 10px; font: inherit; width: 100%;
      outline: none;
    }
    button {
      background: #183c18; color: var(--fg); border: 1px solid #2b6c2b;
      padding: 8px 12px; font: inherit; cursor: pointer;
    }
    button:hover { filter: brightness(1.1); }
    .muted { color: var(--muted); }
    .error { color: var(--error); }
    .progress {
      width: 100%; height: 10px; background: #0e120e; border: 1px solid #214621; margin: 8px 0 12px;
      position: relative;
    }
    .progress > span {
      display: block; height: 100%; width: 0%; background: var(--accent);
      transition: width .5s ease;
    }
    .scan-label { font-size: 0.9em; color: var(--muted); margin-top: -4px; margin-bottom: 8px; }
    canvas { display: block; width: 100%; height: 120px; background: transparent; margin-bottom: 8px; }

    /* --- Terminal einde effects --- */
    .overlay { position: fixed; inset: 0; pointer-events: none; }
    .crt-scanlines::before {
      content: "";
      position: absolute; inset: 0;
      background: repeating-linear-gradient(
        to bottom,
        rgba(0, 0, 0, 0) 0px,
        rgba(0, 0, 0, 0) 2px,
        rgba(0, 0, 0, 0.12) 3px
      );
      mix-blend-mode: multiply;
      animation: scanMove 6s linear infinite;
      opacity: 0;
      transition: opacity .6s ease;
    }
    @keyframes scanMove {
      0% { transform: translateY(-10%); }
      100% { transform: translateY(10%); }
    }
    .flash {
      position: absolute; inset: 0;
      background: radial-gradient(circle at 50% 50%, rgba(255,255,255,0.9), rgba(255,255,255,0.0) 60%);
      opacity: 0; transition: opacity .2s ease;
    }
    .fadeout { position: absolute; inset: 0; background: #051105; opacity: 0; transition: opacity 1.2s ease; }
    .session-closed {
      position: absolute; inset: 0; display: grid; place-items: center; color: var(--accent);
      font-family: "Consolas","Courier New",monospace; font-size: clamp(18px, 2.8vw, 28px);
      opacity: 0; transition: opacity .8s ease;
      text-align: center; white-space: pre-wrap;
    }
    .blink-cursor::after { content: "_"; animation: blink 1s steps(1, start) infinite; }
    #confettiCanvas { position: fixed; inset: 0; width: 100vw; height: 100vh; display: block; pointer-events: none; }
  </style>
</head>
<body>
  <div class="screen" id="screen">
    <canvas id="matrix"></canvas>
    <div class="title">[ ACCESS PORT : COM-TERM v1.9 ]</div>
    <div class="bar"></div>
    <div id="output" aria-live="polite"></div>
    <div id="inputs"></div>
  </div>

  <!-- Overlay voor het visuele einde -->
  <canvas id="confettiCanvas"></canvas>
  <div class="overlay crt-scanlines" id="crtOverlay">
    <div class="flash" id="flash"></div>
    <div class="fadeout" id="fade"></div>
    <div class="session-closed" id="closedText"></div>
  </div>

  <script>
    // ==========================
    //  CONFIG â€“ PAS HIER AAN
    // ==========================
    const VALID = {
      naamAllowList: ["Brenda"],
      // codeExact: "1204",
      codeRegex: /^\d{4}$/
    };

    function finalMessage(state) {
      return `Hey ${state.naam}, Els bewaakt jouw pakje. Zoek onder de boom. 
Scan afgerond met code: ${state.code}. 
Fijne feestdagen! ðŸŽ„`;
    }

    // ==========================
    //  TERMINAL ENGINE
    // ==========================
    const output = document.getElementById('output');
    const inputs = document.getElementById('inputs');
    const state = { naam: null, code: null };

    async function typeLine(text, cls="line", speedMin=15, speedRand=30) {
      const line = document.createElement('div');
      line.className = cls;
      output.appendChild(line);

      const content = typeof text === "function" ? text(state) : String(text);
      let i = 0;
      return new Promise(resolve => {
        const cursor = document.createElement('span');
        cursor.className = 'cursor';
        line.appendChild(cursor);

        (function tick() {
          if (i < content.length) {
            cursor.insertAdjacentText('beforebegin', content[i++]);
            setTimeout(tick, Math.random()*speedRand + speedMin);
          } else {
            cursor.remove();
            resolve();
          }
        })();
      });
    }

    function addProgress(label = "") {
      const p = document.createElement('div'); p.className = 'progress';
      const s = document.createElement('span'); p.appendChild(s);
      output.appendChild(p);

      if (label) {
        const l = document.createElement('div');
        l.className = 'scan-label';
        l.textContent = label;
        output.appendChild(l);
      }

      let val = 0;
      const id = setInterval(() => {
        val = Math.min(100, val + Math.random()*20 + 10);
        s.style.width = val + "%";
        if (val >= 100) clearInterval(id);
      }, 300);
      return new Promise(res => setTimeout(res, 2200));
    }

    function askInput(cfg) {
      return new Promise(resolve => {
        const row = document.createElement('div'); row.className = 'input-row';
        const prompt = document.createElement('span'); prompt.className = 'prompt'; prompt.textContent = `> ${cfg.label}:`;
        const field = document.createElement('input'); field.type = cfg.type || 'text'; field.placeholder = cfg.placeholder || '';
        const btn = document.createElement('button'); btn.type = 'button'; btn.textContent = cfg.button || 'OK';
        row.append(prompt, field, btn);
        inputs.appendChild(row);
        field.focus();

        const finish = () => {
          const val = field.value.trim();
          if (!val) return;
          const echo = document.createElement('div'); echo.className = 'line muted';
          echo.textContent = `> ${cfg.label} = ${cfg.type === 'password' ? '****' : val}`;
          output.appendChild(echo);
          inputs.removeChild(row);
          resolve(val);
        };
        btn.addEventListener('click', finish);
        field.addEventListener('keydown', e => { if (e.key === 'Enter') finish(); });
      });
    }

    async function showError(msg) {
      await typeLine(`ERROR: ${msg}`, "line error");
    }

    function isValidName(name) {
      if (!name) return false;
      const n = name.trim().toLowerCase();
      if (Array.isArray(VALID.naamAllowList)) {
        return VALID.naamAllowList.some(v => v.toLowerCase() === n);
      }
      return false;
    }

    function isValidCode(code) {
      if (!code) return false;
      if (VALID.codeRegex instanceof RegExp) return VALID.codeRegex.test(code);
      if (VALID.codeExact) return code === VALID.codeExact;
